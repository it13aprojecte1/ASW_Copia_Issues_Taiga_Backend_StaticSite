<div class="issue-form-container">
  <h2 class="text-center"><%= issue.subject %></h2>
  <div class="form-layout">
    <div class="left-column">
      <p>
        <strong>Content:</strong><br>
        <div class="large-textarea"><%= issue.content %></div>
      </p>
      <h2>Comentarios</h2>
        <% if issue.comments.any? %>
          <ul>
            <% issue.comments.each do |comment| %>
              <li>
                <strong><%= comment.user.email %>:</strong>
                <%= comment.content %>
              </li>
            <% end %>
          </ul>
        <% else %>
          <p class="text-muted">No hay comentarios.</p>
        <% end %>
      <h2>Añadir Comentario</h2>
      <%= form_with(model: [issue, Comment.new]) do |form| %>
        <%= form.text_area :content, class: 'large-textarea' %>
        <%= form.submit 'Añadir Comentario', class: 'btn-create' %>
      <% end %>

      <div class="attachments-section">
        <div class="attachments-header">
          <h2><%= issue.attachments.count %> Attachments</h2>
        </div>

        <% if issue.attachments.attached? %>
          <div class="attachment-list">
            <% issue.attachments.each do |attachment| %>
              <div class="attachment-item">
                <div class="attachment-info">
                  <span class="attachment-name"><%= attachment.filename %></span>
                  <span class="attachment-size"><%= number_to_human_size(attachment.byte_size) %>)</span>
                </div>
                <div class="attachment-actions">
                  <%= link_to rails_blob_path(attachment, disposition: "attachment"), class: "download-link" do %>
                    <i class="download-icon">↓</i>
                  <% end %>
                  <%= button_to attachment_issue_path(issue, attachment_id: attachment.id),
                        method: :delete,
                        class: "trash-btn",
                        data: { confirm: '¿Estás seguro?' } do %>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#dc3545" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="no-attachments">No hay archivos adjuntos.</p>
        <% end %>

        <%= form_with(model: issue, local: true, multipart: true) do |form| %>
          <div class="custom-file-upload">
            <%= form.file_field :attachments, multiple: true, class: "hidden-file-input", id: "file-upload" %>
            <label for="file-upload" class="custom-file-label">Elegir archivos</label>
            <%= form.submit 'Subir archivos', class: 'btn-create' %>
          </div>
        <% end %>
      </div>
    </div>
    <div class="right-column">
      <div class="custom-select-box">
        <div class="select-container">
          <span class="select-label">State:</span>
          <span class="custom-select"><%= issue.status.name %></span>
        </div>
      </div>
      <div class="custom-select-box">
        <div class="select-container">
          <span class="select-label">Type:</span>
          <span class="custom-select"><%= issue.issue_type.name %></span>
        </div>
      </div>
      <div class="custom-select-box">
        <div class="select-container">
          <span class="select-label">Severity:</span>
          <span class="custom-select"><%= issue.severity.name %></span>
        </div>
      </div>
      <div class="custom-select-box">
        <div class="select-container">
          <span class="select-label">Priority:</span>
          <span class="custom-select"><%= issue.priority.name %></span>
        </div>
      </div>
      <div class="custom-select-box">
        <div class="select-container">
          <span class="select-label">User:</span>
          <span class="custom-select"><%= issue.user.email %></span>
        </div>
      </div>
      <div class="custom-select-box">
        <div class="select-container">
          <span class="select-label">Assigned to:</span>
          <% if issue.assignee.present? %>
            <span class="custom-select"><%= issue.assignee.email %></span>
          <% else %>
            <span class="text-muted">No assignee</span>
          <% end %>
        </div>
      </div>
      <!-- Aquí comienza la sección de watchers -->
      <div class="custom-select-box">
        <div class="select-container">
          <span class="select-label">Watchers:</span>
          <div class="watchers-list">
            <% if issue.watchers.any? %>
              <% issue.watchers.each do |watcher| %>
                <div class="watcher-item"><%= watcher.email %></div>
              <% end %>
            <% else %>
              <span class="text-muted">No watchers</span>
            <% end %>
          </div>
        </div>
      </div>
      <!-- Fin de la sección de watchers -->
      <p>
        <strong>Created At:</strong><br>
        <%= issue.created_at.strftime("%A, %y-%m-%d %H:%M") %>
      </p>
      <!-- Campo de Deadline siempre visible -->
      <p>
        <strong>Deadline:</strong><br>
        <% if issue.deadline.present? %>
          <%= issue.deadline.strftime("%A, %y-%m-%d %H:%M") %>
        <% else %>
          <span class="text-muted">No deadline</span>
        <% end %>
      </p>
      <a href="#" class="add-tag">Add tag +</a>

      <div class="action-icons-container">
        <%= link_to edit_issue_path(issue), class: "action-icon edit-icon" do %>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#0085A1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
          </svg>
        <% end %>

        <%= button_to issue_path(issue), method: :delete, class: "action-icon delete-icon", data: { confirm: "¿Estás seguro de que quieres eliminar esta issue?" } do %>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#0085A1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
        <% end %>
      </div>
    </div>
  </div>
</div>